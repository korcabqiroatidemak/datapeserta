<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DATA PESERTA</title>

<style>
/* ===================== PAGE SETUP ===================== */
@page {
    size: 215mm 330mm;
    margin: 10mm 15mm 15mm 15mm;
}

body {
    margin: 0;
    font-family: "Times New Roman", serif;
    background: #eee;
}

/* ===================== PANEL KONTROL ===================== */
#panel {
    background: #fff;
    padding: 10px;
    border-bottom: 2px solid #000;
}

.panel-row {
    display: flex;
    gap: 15px;
    margin-bottom: 6px;
    align-items: center;
}

.panel-row label {
    font-weight: bold;
    white-space: nowrap;
}

#shift-container {
    display: grid;
    grid-template-rows: repeat(3, auto);
    grid-auto-flow: column;
    gap: 4px 12px;
    max-width: 100%;
    overflow-x: auto;
    border: 1px solid #ccc;
    padding: 6px;
}

/* ===================== CETAK ===================== */
@media print {
    #panel { display: none; }
    body { background: #fff; }
}

/* ===================== HALAMAN ===================== */
.page {
    width: 100%;
    height: calc(330mm - 25mm);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    page-break-after: always;
}

/* ===================== HEADER ===================== */
.header {
    grid-column: 1 / -1;
    border-bottom: 2px solid #000;
    padding-bottom: 6px;
    margin-bottom: 6px;
}

.header h1 {
    margin: 0;
    font-size: 16pt;
    text-align: center;
}

.header .meta {
    display: flex;
    justify-content: space-between;
    font-size: 11pt;
}

/* ===================== KARTU ===================== */
.card {
    border: 1px solid #000;
    padding: 5px;
    display: flex;
    font-size: 10pt;
}

.foto {
    width: 30mm;
    height: 40mm;
    border: 1px solid #aaa;
    margin-right: 6px;
    flex-shrink: 0;
}

.foto img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.info div {
    line-height: 1.2;
}

.label {
    font-weight: bold;
}

/* ===================== GRID MODE ===================== */
.page.first .card { height: calc((100% - 60mm) / 5); }
.page.next  .card { height: calc(100% / 6); }
</style>
</head>

<body>

<!-- ===================== PANEL ===================== -->
<div id="panel">
    <div class="panel-row">
        <label>Judul</label>
        <input id="judul" value="DATA PESERTA">
        <label>Periode</label>
        <input id="periode" value="Rojab 1447 H">
    </div>

    <div class="panel-row">
        <label>Pilih Gelombang & Shift</label>
    </div>

    <div id="shift-container"></div>

    <button onclick="render()">TAMPILKAN / CETAK</button>
</div>

<div id="output"></div>

<script>
/* ===================== DATA SOURCE ===================== */
const SHEET_ID = '1eIcvIgCLWG3F9jQdsw5XN9llOsK2PoYWKUg1qaQJyyA';
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=Biodata Cek`;

let DATA = [];

/* ===================== FETCH ===================== */
fetch(SHEET_URL)
.then(r => r.text())
.then(csv => {
    const rows = csv.trim().split('\n');
    const header = rows.shift().split(',').map(h => h.replace(/"/g,''));
    rows.forEach(r => {
        const cols = r.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
        let obj = {};
        header.forEach((h,i)=>obj[h]=cols[i]?.replace(/"/g,'')||'');
        DATA.push(obj);
    });
    buildShiftPanel();
});

/* ===================== PANEL SHIFT ===================== */
function buildShiftPanel(){
    const c = document.getElementById('shift-container');
    const uniq = [...new Set(DATA.map(d=>`${d.Gelombang} | ${d.Shift}`))];
    uniq.forEach(v=>{
        const cb = document.createElement('label');
        cb.innerHTML = `<input type="checkbox" value="${v}"> ${v}`;
        c.appendChild(cb);
    });
}

/* ===================== RENDER ===================== */
function render(){
    const out = document.getElementById('output');
    out.innerHTML = '';

    const judul = judul.value;
    const periode = periode.value;

    const checked = [...document.querySelectorAll('#shift-container input:checked')]
        .map(cb=>cb.value);

    checked.forEach(sel=>{
        const [gel, shift] = sel.split(' | ');
        const peserta = DATA.filter(d=>d.Gelombang==gel && d.Shift==shift);

        let idx = 0;
        let first = true;

        while(idx < peserta.length){
            const page = document.createElement('div');
            page.className = 'page ' + (first?'first':'next');

            if(first){
                page.innerHTML += `
                <div class="header">
                    <h1>${judul}</h1>
                    <div class="meta">
                        <span>Periode: ${periode}</span>
                        <span>Gelombang ${gel} â€“ Shift ${shift}</span>
                    </div>
                </div>`;
            }

            const limit = first ? 10 : 12;
            peserta.slice(idx, idx+limit).forEach(p=>{
                page.appendChild(card(p));
            });

            out.appendChild(page);
            idx += limit;
            first = false;
        }
    });
}

/* ===================== CARD ===================== */
function card(d){
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
        <div class="foto"></div>
        <div class="info">
            <div><span class="label">ID</span> : ${d['ID Pendaftaran']}</div>
            <div><span class="label">Nama</span> : ${d['Nama Lengkap (Sesuai Akta)']}</div>
            <div><span class="label">Lemb.</span> : ${d['Asal Lembaga / TPQ']}</div>
            <div><span class="label">TTL</span> : ${d['Tempat Lahir']}, ${d['Tanggal Lahir']}</div>
            <div><span class="label">JK</span> : ${d['Jenis Kelamin']}</div>
            <div><span class="label">BIN</span> : ${d['Nama Ayah']}</div>
            <div><span class="label">BINTI</span> : ${d['Nama Ibu']}</div>
        </div>`;
    return div;
}
</script>
</body>
</html>
